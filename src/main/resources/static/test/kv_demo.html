<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test for hello</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <link rel = "stylesheet" href = "./css/style.css">
</head>
<body>
    <div id="app">
        <div class="container">
            <header>
                <h1>Hello æ¨¡å—ç”¨ä¾‹å±•ç¤º</h1>
                <p class="subtitle">å®ç°key valueçš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½</p>
            </header>
            
            <div class="content">
                <!-- æ“ä½œåŒºåŸŸ -->
                <div>
                    <div class="card">
                        <h2>æ•°æ®æ“ä½œ</h2>
                        
                        <div class="tabs">
                            <div class="tab" :class="{ active: activeTab === 'create' }" @click="activeTab = 'create'">
                                æ–°å¢æ•°æ®
                            </div>
                            <div class="tab" :class="{ active: activeTab === 'read' }" @click="activeTab = 'read'">
                                æŸ¥è¯¢æ•°æ®
                            </div>
                            <div class="tab" :class="{ active: activeTab === 'update' }" @click="activeTab = 'update'">
                                æ›´æ–°æ•°æ®
                            </div>
                            <div class="tab" :class="{ active: activeTab === 'delete' }" @click="activeTab = 'delete'">
                                åˆ é™¤æ•°æ®
                            </div>
                        </div>
                        
                        <!-- æ–°å¢æ•°æ® -->
                        <div class="tab-content" :class="{ active: activeTab === 'create' }">
                            <div class="operation-card create">
                                <div class="operation-title">
                                    <span class="operation-icon">â•</span>
                                    <span>æ–°å¢æ•°æ®</span>
                                </div>
                                <p>æ·»åŠ æ–°çš„é”®å€¼å¯¹åˆ°æ•°æ®å­˜å‚¨ä¸­</p>
                                
                                <div class="operation-form">
                                    <div class="form-group">
                                        <label for="create-key">é”® (Key)</label>
                                        <input type="text" id="create-key" v-model="createForm.key" placeholder="è¯·è¾“å…¥é”®å">
                                    </div>
                                    <div class="form-group">
                                        <label for="create-value">å€¼ (Value)</label>
                                        <textarea id="create-value" v-model="createForm.value" placeholder="è¯·è¾“å…¥å€¼å†…å®¹"></textarea>
                                    </div>
                                    <button class="btn btn-success" @click="createData" :disabled="loading">
                                        {{ loading && currentOperation === 'create' ? 'æäº¤ä¸­...' : 'æ–°å¢æ•°æ®' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æŸ¥è¯¢æ•°æ® -->
                        <div class="tab-content" :class="{ active: activeTab === 'read' }">
                            <div class="operation-card read">
                                <div class="operation-title">
                                    <span class="operation-icon">ğŸ”</span>
                                    <span>æŸ¥è¯¢æ•°æ®</span>
                                </div>
                                <p>æ ¹æ®é”®åæŸ¥è¯¢å¯¹åº”çš„å€¼</p>
                                
                                <div class="operation-form">
                                    <div class="form-group">
                                        <label for="read-key">é”® (Key)</label>
                                        <input type="text" id="read-key" v-model="readForm.key" placeholder="è¯·è¾“å…¥è¦æŸ¥è¯¢çš„é”®å">
                                    </div>
                                    <button class="btn" @click="readData" :disabled="loading">
                                        {{ loading && currentOperation === 'read' ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢æ•°æ®' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ›´æ–°æ•°æ® -->
                        <div class="tab-content" :class="{ active: activeTab === 'update' }">
                            <div class="operation-card update">
                                <div class="operation-title">
                                    <span class="operation-icon">âœï¸</span>
                                    <span>æ›´æ–°æ•°æ®</span>
                                </div>
                                <p>æ›´æ–°æŒ‡å®šé”®çš„å€¼</p>
                                
                                <div class="operation-form">
                                    <div class="form-group">
                                        <label for="update-key">é”® (Key)</label>
                                        <input type="text" id="update-key" v-model="updateForm.key" placeholder="è¯·è¾“å…¥è¦æ›´æ–°çš„é”®å">
                                    </div>
                                    <div class="form-group">
                                        <label for="update-value">å€¼ (Value)</label>
                                        <textarea id="update-value" v-model="updateForm.value" placeholder="è¯·è¾“å…¥æ–°çš„å€¼å†…å®¹"></textarea>
                                    </div>
                                    <button class="btn btn-warning" @click="updateData" :disabled="loading">
                                        {{ loading && currentOperation === 'update' ? 'æ›´æ–°ä¸­...' : 'æ›´æ–°æ•°æ®' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åˆ é™¤æ•°æ® -->
                        <div class="tab-content" :class="{ active: activeTab === 'delete' }">
                            <div class="operation-card delete">
                                <div class="operation-title">
                                    <span class="operation-icon">ğŸ—‘ï¸</span>
                                    <span>åˆ é™¤æ•°æ®</span>
                                </div>
                                <p>åˆ é™¤æŒ‡å®šé”®çš„æ•°æ®</p>
                                
                                <div class="operation-form">
                                    <div class="form-group">
                                        <label for="delete-key">é”® (Key)</label>
                                        <input type="text" id="delete-key" v-model="deleteForm.key" placeholder="è¯·è¾“å…¥è¦åˆ é™¤çš„é”®å">
                                    </div>
                                    <button class="btn btn-danger" @click="deleteData" :disabled="loading">
                                        {{ loading && currentOperation === 'delete' ? 'åˆ é™¤ä¸­...' : 'åˆ é™¤æ•°æ®' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="loading" class="loading">
                            <div class="spinner"></div>
                            <p>{{ loadingMessage }}</p>
                        </div>
                        
                        <div v-if="message" :class="['message', messageType === 'success' ? 'message-success' : 'message-error']">
                            {{ message }}
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
                <div>
                    <div class="card">
                        <h2>æ“ä½œå†å²</h2>
                        
                        <div class="data-display" v-if="operationHistory.length > 0">
                            <div class="data-item" v-for="(history, index) in operationHistory.slice().reverse()" :key="index">
                                <div class="data-key">{{ history.operation }} - {{ history.timestamp }}</div>
                                <div class="data-value">
                                    <div v-if="history.operation === 'æŸ¥è¯¢'">
                                        é”®: {{ history.key }}<br>
                                        ç»“æœ: {{ history.result }}
                                    </div>
                                    <div v-else>
                                        é”®: {{ history.key }}<br>
                                        <span v-if="history.value">å€¼: {{ history.value }}</span>
                                        <span v-if="history.oldValue">åŸå€¼: {{ history.oldValue }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="no-data" v-else>
                            <div class="no-data-icon">ğŸ“‹</div>
                            <h3>æš‚æ— æ“ä½œè®°å½•</h3>
                            <p>æ“ä½œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer>
                michaelxu365@gmail.comï½œkey value è¯»å†™æ¼”ç¤º
            </footer>
        </div>
    </div>

    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // å“åº”å¼æ•°æ®
                const loading = ref(false);
                const message = ref('');
                const messageType = ref('success');
                const activeTab = ref('create');
                const currentOperation = ref('');
                const loadingMessage = ref('');
                const operationHistory = ref([]);
                const baseURL = 'http://114.132.58.71:9999/hello';
                
                // è¡¨å•æ•°æ®
                const createForm = ref({
                    key: '',
                    value: ''
                });
                
                const readForm = ref({
                    key: ''
                });
                
                const updateForm = ref({
                    key: '',
                    value: ''
                });
                
                const deleteForm = ref({
                    key: ''
                });
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                const showMessage = (text, type = 'success') => {
                    message.value = text;
                    messageType.value = type;
                    setTimeout(() => {
                        message.value = '';
                    }, 10000); // æç¤ºæ¶ˆæ¯10ç§’åæ¶ˆå¤±
                };
                
                // æ·»åŠ æ“ä½œè®°å½•
                const addHistory = (operation, key, value = null, oldValue = null, result = null) => {
                    operationHistory.value.push({
                        operation,
                        key,
                        value,
                        oldValue,
                        result,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // é™åˆ¶å†å²è®°å½•æ•°é‡
                    if (operationHistory.value.length > 10) {
                        operationHistory.value.shift();
                    }
                };
                
                // æ–°å¢æ•°æ®
                const createData = async () => {
                    if (!createForm.value.key) {
                        showMessage('è¯·è¾“å…¥é”®å', 'error');
                        return;
                    }
                    
                    if (!createForm.value.value) {
                        showMessage('è¯·è¾“å…¥å€¼å†…å®¹', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    currentOperation.value = 'create';
                    loadingMessage.value = 'æ­£åœ¨æ·»åŠ æ•°æ®...';
                    
                    try {
                        // ä½¿ç”¨axioså‘é€POSTè¯·æ±‚
                        const response = await axios.post(`${baseURL}/${createForm.value.key}`,createForm.value.value,{"headers":{"Content-type":"application/json"}});
                        
                        // æ·»åŠ æ“ä½œè®°å½•
                        addHistory('æ–°å¢', createForm.value.key, createForm.value.value);
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        showMessage(`æ•°æ® "${createForm.value.key}" æ·»åŠ æˆåŠŸ`);
                        
                        // æ¸…ç©ºè¡¨å•
                        createForm.value.key = '';
                        createForm.value.value = '';
                        
                    } catch (error) {
                        showMessage(`æ·»åŠ æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                    } finally {
                        loading.value = false;
                        currentOperation.value = '';
                    }
                };
                
                // æŸ¥è¯¢æ•°æ®
                const readData = async () => {
                    
                    loading.value = true;
                    currentOperation.value = 'read';
                    loadingMessage.value = 'æ­£åœ¨æŸ¥è¯¢æ•°æ®...';
                    
                    try {
                        url = `${baseURL}`;
                        if (readForm.value.key != '') {
                            url = `${url}/${readForm.value.key}`;
                        }
                        const response = await axios.get(url);

                        if (response) {
                            // æ·»åŠ æ“ä½œè®°å½•
                            addHistory('æŸ¥è¯¢', readForm.value.key, null, null, response.data);
                            
                            showMessage(`æŸ¥è¯¢æˆåŠŸ: key=${readForm.value.key},value=${JSON.stringify(response.data)}`);
                        } else {
                            showMessage(`æœªæ‰¾åˆ°é”®åä¸º "${readForm.value.key}" çš„æ•°æ®`, 'error');
                        }
                        
                    } catch (error) {
                        showMessage(`æŸ¥è¯¢æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                    } finally {
                        loading.value = false;
                        currentOperation.value = '';
                    }
                };
                
                // æ›´æ–°æ•°æ®
                const updateData = async () => {
                    if (!updateForm.value.key) {
                        showMessage('è¯·è¾“å…¥è¦æ›´æ–°çš„é”®å', 'error');
                        return;
                    }
                    
                    if (!updateForm.value.value) {
                        showMessage('è¯·è¾“å…¥æ–°çš„å€¼å†…å®¹', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    currentOperation.value = 'update';
                    loadingMessage.value = 'æ­£åœ¨æ›´æ–°æ•°æ®...';
                    
                    try {
                        const response = await axios.post(`${baseURL}/${updateForm.value.key}`,updateForm.value.value,{"headers":{"Content-type":"application/json"}});
                        // æ·»åŠ æ“ä½œè®°å½•
                        addHistory('æ›´æ–°', updateForm.value.key, updateForm.value.value,null);
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        showMessage(`æ•°æ® "${updateForm.value.key}" æ›´æ–°æˆåŠŸ`);
                        
                        // æ¸…ç©ºè¡¨å•
                        updateForm.value.key = '';
                        updateForm.value.value = '';
                        
                    } catch (error) {
                        showMessage(`æ›´æ–°æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                    } finally {
                        loading.value = false;
                        currentOperation.value = '';
                    }
                };
                
                // åˆ é™¤æ•°æ®
                const deleteData = async () => {
                    if (!deleteForm.value.key) {
                        showMessage('è¯·è¾“å…¥è¦åˆ é™¤çš„é”®å', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    currentOperation.value = 'delete';
                    loadingMessage.value = 'æ­£åœ¨åˆ é™¤æ•°æ®...';
                    
                    try {
                        const response = await axios.delete(`${baseURL}/${deleteForm.value.key}`);
                        // æ·»åŠ æ“ä½œè®°å½•
                        addHistory('åˆ é™¤', deleteForm.value.key, null, null);
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        showMessage(`æ•°æ® "${deleteForm.value.key}" åˆ é™¤æˆåŠŸ`);
                        
                        // æ¸…ç©ºè¡¨å•
                        deleteForm.value.key = '';
                        
                    } catch (error) {
                        showMessage(`åˆ é™¤æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                    } finally {
                        loading.value = false;
                        currentOperation.value = '';
                    }
                };
                
                // ç¡®è®¤åˆ é™¤
                const confirmDelete = (key) => {
                    if (confirm(`ç¡®å®šè¦åˆ é™¤é”®ä¸º "${key}" çš„æ•°æ®å—ï¼Ÿ`)) {
                        deleteForm.value.key = key;
                        deleteData();
                    }
                };
                
                
                return {
                    loading,
                    message,
                    messageType,
                    activeTab,
                    currentOperation,
                    loadingMessage,
                    operationHistory,
                    createForm,
                    readForm,
                    updateForm,
                    deleteForm,
                    createData,
                    readData,
                    updateData,
                    deleteData,
                    confirmDelete
                };
            }
        }).mount('#app');
    </script>
</body>
</html>